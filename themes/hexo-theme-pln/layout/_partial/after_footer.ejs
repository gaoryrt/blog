<script src="<%- config.root %>js/zoom-image.js"></script>
<script type="text/javascript">
  document.body.style.opacity = '1'
  document.addEventListener('visibilitychange', function() {
    if (document.visibilityState === 'visible') {
      document.body.style.opacity = '1'
    }
  })

  // img zoom
  var imgArr = document.getElementsByTagName('img')
  for (var i = 0; i < imgArr.length; i += 1) {
    zoom(imgArr[i])
  }

  // dropdown scripts
  function $(s) {
    return document.querySelector(s)
  }

  function $$(s) {
    return document.querySelectorAll(s)
  }
  var dropDownElArr = $$('.dropdown')
  for (var i = 0; i < dropDownElArr.length; i += 1) {
    dropDownElArr[i].addEventListener('click', function(event) {
      var content = this.querySelector('.dropdown-content')
      event.stopPropagation()
      if (content.className.indexOf('open') < 0) {
        content.classList.add('open')
      } else {
        content.classList.remove('open')
      }
    })
  }
  document.body.addEventListener('click', function() {
    var dropDownContentElArr = $$('.dropdown-content')
    for (var i = 0; i < dropDownContentElArr.length; i += 1) {
      dropDownContentElArr[i].classList.remove('open')
    }
  })

  // smooth scroll
  $$('a[href^="#"]').forEach(e => {
    e.addEventListener("click", function(e) {
      e.preventDefault();
      var t = this.getAttribute("href").substr(1);
      $(`[id='${decodeURIComponent(t)}']`).scrollIntoView({
          behavior: "smooth"
        }),
        t === "top" ? history.replaceState(null, null, " ") : history.pushState(null, null, `#${t}`)
    })
  })

  // transition
  $$('a[href^="\/"]').forEach(e => {
    e.addEventListener("click", function(e) {
      if (!e.metaKey) {
        document.body.style.opacity = '0'
      }
    })
  })

  var xhr = new XMLHttpRequest();
  xhr.open("GET", "https://42.gaoryrt.com/c/hit?hit=889&key=" + encodeURIComponent(location.pathname));
  xhr.responseType = "json";
  xhr.onload = function() {
    console.log(this.response)
    document.getElementById('page_pv').innerText = this.response.value;
  }
  xhr.send();
</script>
